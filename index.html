<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>F√© Power-Up: Curso de Crisma</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Configura√ß√£o de Fontes e Cores */
        :root {
            --duo-green: #58cc02;
            --duo-dark-green: #40a000;
            --duo-blue: #1cb0f6;
            --duo-yellow: #ffc800;
            --duo-red: #ff4b4b;
            --duo-light-gray: #f7f7f7;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--duo-light-gray);
            padding-bottom: 90px; /* Espa√ßo para menu inferior */
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Estilos Personalizados */
        .duo-header { background-color: white; border-bottom: 2px solid #e5e5e5; }
        
        .duo-start-btn {
            background-color: var(--duo-green);
            border-bottom: 4px solid var(--duo-dark-green);
            transition: all 0.1s;
        }
        .duo-start-btn:active { transform: translateY(2px); border-bottom-width: 0px; margin-top: 4px; }
        
        .duo-option-btn {
            background-color: white;
            border: 2px solid #e5e5e5;
            border-bottom: 4px solid #e5e5e5;
        }
        .duo-option-btn:active { border-bottom-width: 2px; transform: translateY(2px); }
        .duo-selected { border-color: var(--duo-blue) !important; background-color: #ddf4ff !important; color: var(--duo-blue); }
        .duo-correct { background-color: #d7ffb8 !important; border-color: var(--duo-green) !important; color: var(--duo-dark-green); }
        .duo-wrong { background-color: #ffdde0 !important; border-color: var(--duo-red) !important; color: var(--duo-red); }
        
        /* Menu Inferior */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 2px solid #e5e5e5;
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 50;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #afafaf;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        .nav-item.active { color: var(--duo-blue); }
        .nav-item svg { width: 26px; height: 26px; margin-bottom: 4px; }

        /* Anima√ß√µes */
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.4s ease-out forwards; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

    <!-- Tela de Carregamento -->
    <div id="loading-screen" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center p-4 text-center">
        <div id="loading-spinner">
            <svg class="animate-spin h-12 w-12 text-duo-green mb-4 mx-auto" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="text-xl font-bold text-gray-700">Conectando ao Curso...</p>
        </div>
        <div id="error-message" class="hidden">
            <p class="text-red-500 font-bold mb-4">Ocorreu um erro ao carregar.</p>
            <button onclick="location.reload()" class="bg-gray-200 px-4 py-2 rounded font-bold text-gray-700">Tentar Novamente</button>
        </div>
    </div>

    <!-- Modal de Nome -->
    <div id="name-modal" class="fixed inset-0 z-40 hidden items-center justify-center p-4 bg-black bg-opacity-60 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-6 shadow-2xl w-full max-w-sm text-center animate-slide-up">
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Bem-vindo!</h2>
            <p class="text-gray-600 mb-6">Qual seu nome para o Ranking?</p>
            <input type="text" id="user-name-input" placeholder="Digite seu nome" class="w-full border-2 border-gray-300 rounded-xl p-3 text-lg mb-4 text-center font-bold outline-none focus:border-duo-blue">
            <button onclick="window.App.saveUserName()" class="w-full duo-start-btn text-white font-bold py-3 rounded-xl uppercase tracking-wider">Come√ßar</button>
        </div>
    </div>

    <!-- Header -->
    <header class="duo-header p-3 sticky top-0 z-20 shadow-sm flex justify-between items-center px-4 safe-top">
        <span class="font-extrabold text-xl tracking-tight text-duo-green" id="header-title">F√© Power-Up</span>
        <div class="flex items-center space-x-2">
            <div class="flex items-center bg-yellow-100 px-3 py-1 rounded-full border border-yellow-400">
                <span class="mr-1 text-yellow-600">‚òÖ</span>
                <span id="current-score" class="text-yellow-700 font-bold">0</span>
            </div>
            <div id="hearts-display" class="hidden flex items-center text-duo-red font-bold">
                <span class="mr-1">‚ù§Ô∏è</span>
                <span id="hearts-count">5</span>
            </div>
        </div>
    </header>

    <!-- App Container -->
    <div id="app" class="flex flex-col flex-grow w-full max-w-2xl mx-auto"></div>

    <!-- Menu Inferior -->
    <nav class="bottom-nav safe-bottom">
        <button onclick="window.App.navigateTo('map')" class="nav-item active" id="nav-map">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
            Aulas
        </button>
        <button onclick="window.App.loadLeaderboard()" class="nav-item" id="nav-ranking">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></svg>
            Ranking
        </button>
    </nav>

    <!-- Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // CONFIGURA√á√ÉO FIREBASE
        const appId = 'crisma-2026';
        const firebaseConfig = {
            apiKey: "AIzaSyCoR6nlyCfsozUpwLo7iB8bUgQ-fdQ_14o",
            authDomain: "curso26-bcabf.firebaseapp.com",
            projectId: "curso26-bcabf",
            storageBucket: "curso26-bcabf.firebasestorage.app",
            messagingSenderId: "691991061470",
            appId: "1:691991061470:web:7a5fa026c4f836069d734f"
        };

        let db, auth;

        window.initializeFirebase = async () => {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Timeout de Seguran√ßa (se travar no carregando)
                setTimeout(() => {
                    if (document.getElementById('loading-screen') && !document.getElementById('loading-screen').classList.contains('hidden')) {
                        document.getElementById('loading-spinner').classList.add('hidden');
                        document.getElementById('error-message').classList.remove('hidden');
                    }
                }, 8000);

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        window.App.init(db, user.uid);
                    } else {
                        signInAnonymously(auth).catch(e => console.error(e));
                    }
                });
            } catch (error) {
                console.error("Erro Firebase:", error);
                document.getElementById('loading-spinner').classList.add('hidden');
                document.getElementById('error-message').classList.remove('hidden');
                document.getElementById('error-message').querySelector('p').innerText = "Erro ao conectar: " + error.message;
            }
        };

        window.startProgressListener = function(userId) {
            const docRef = doc(db, 'artifacts', appId, 'users', userId, 'progress', 'crisma');
            onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    window.App.setUserProgress(docSnap.data());
                } else {
                    window.App.setUserProgress({ score: 0, completedLessons: {}, name: null });
                }
                const screen = document.getElementById('loading-screen');
                if(screen) screen.classList.add('hidden');
            }, (error) => {
                console.error("Erro snapshot:", error);
            });
        };

        window.saveProgress = async (progress) => {
            if (!window.App.userId || !db) return;
            const userRef = doc(db, 'artifacts', appId, 'users', window.App.userId, 'progress', 'crisma');
            await setDoc(userRef, progress, { merge: true });

            if (progress.name) {
                const lbRef = doc(db, 'artifacts', appId, 'leaderboard', window.App.userId);
                await setDoc(lbRef, { name: progress.name, score: progress.score });
            }
        };

        window.getLeaderboard = async () => {
            try {
                const q = query(collection(db, 'artifacts', appId, 'leaderboard'), orderBy("score", "desc"), limit(20));
                const snap = await getDocs(q);
                let leaders = [];
                snap.forEach(d => leaders.push(d.data()));
                return leaders;
            } catch (e) {
                console.error(e);
                return [];
            }
        };

        window.onload = initializeFirebase;
    </script>

    <script type="text/javascript">
        // Helper para placeholders
        const generatePlaceholderQuestions = (lessonId) => {
            return Array.from({ length: 10 }, (_, i) => ({
                q: `Pergunta ${i + 1} sobre o tema da Aula ${lessonId}?`,
                a: "Resposta Correta",
                o: ["Op√ß√£o Errada 1", "Op√ß√£o Errada 2", "Op√ß√£o Errada 3"]
            }));
        };

        // --- CONTE√öDO CORRIGIDO E TESTADO ---
        const courseData = {
            1: {
                id: 1,
                title: "Ora√ß√£o - Nossa F√© nos Reuniu",
                bible_ref: "Hebreus 11,6-12",
                points: 200,
                content: ["**O que √© Ora√ß√£o?** √â o di√°logo de amor entre Deus e o homem.", "**A Base da F√©.** Sem f√© √© imposs√≠vel agradar a Deus."],
                quiz_questions: [
                    { q: "Qual o tema principal de Hebreus 11,6?", a: "A import√¢ncia da F√©", o: ["A cria√ß√£o do mundo", "A vida dos anjos", "A vinda de Cristo"] },
                    { q: "Como a Igreja define a Ora√ß√£o?", a: "Di√°logo de amor com Deus", o: ["Recitar textos", "Pedir coisas", "Pensar em problemas"] }
                ]
            },
            2: {
                id: 2,
                title: "Quem √© Deus - A Sant√≠ssima Trindade",
                bible_ref: "1 Jo√£o 4,12-16",
                points: 200,
                content: ["**Mist√©rio:** Um s√≥ Deus em tr√™s Pessoas.", "**Pai, Filho, Esp√≠rito Santo.**"],
                quiz_questions: [
                    { q: "Quantas Pessoas existem na Trindade?", a: "Tr√™s", o: ["Uma", "Duas", "Quatro"] },
                    { q: "Qual a verdade central da f√© crist√£?", a: "A Sant√≠ssima Trindade", o: ["A cria√ß√£o", "Maria", "Os anjos"] }
                ]
            },
            3: {
                id: 3,
                title: "Jesus - Quem √© o Filho de Deus?",
                bible_ref: "Jo√£o 14,8-11",
                points: 200,
                content: ["**Natureza:** Jesus √© Deus e Homem.", "**Messias:** O Cristo esperado.", "**Caminho:** Ningu√©m vai ao Pai sen√£o por Ele."],
                quiz_questions: [
                    { q: "Quais s√£o as duas naturezas de Jesus?", a: "Divina e Humana", o: ["Anjo e Homem", "Esp√≠rito e Carne", "Rei e Servo"] },
                    { q: "O que significa o t√≠tulo 'Cristo'?", a: "Ungido", o: ["Rei", "Salvador", "Mestre"] },
                    { q: "Jesus disse: 'Eu sou o Caminho, a Verdade e a...'", a: "Vida", o: ["Luz", "Porta", "Paz"] },
                    { q: "Onde Jesus nasceu?", a: "Bel√©m", o: ["Nazar√©", "Jerusal√©m", "Roma"] }
                ]
            },
            4: {
                id: 4,
                title: "Por que Jesus foi Crucificado?",
                bible_ref: "Lucas 23,33-47",
                points: 200,
                content: ["**Amor Supremo:** Entregou-se por n√≥s.", "**Perd√£o:** Perdoou na cruz."],
                quiz_questions: [
                    { q: "Qual o motivo da morte de Jesus?", a: "Nossos pecados e Seu amor", o: ["Acidente pol√≠tico", "Fuga", "Engano"] },
                    { q: "O que Jesus pediu na cruz?", a: "Perd√£o aos algozes", o: ["Vingan√ßa", "√Ågua", "Liberdade"] },
                    { q: "Quem condenou Jesus?", a: "P√¥ncio Pilatos", o: ["Herodes", "Pedro", "Judas"] },
                    { q: "O sacrif√≠cio trouxe...", a: "Salva√ß√£o", o: ["Riqueza", "Fama", "Sorte"] }
                ]
            },
            5: {
                id: 5,
                title: "Ressurrei√ß√£o de Jesus",
                bible_ref: "Jo√£o 20,1-10",
                points: 200,
                content: ["**Vit√≥ria:** Ele venceu a morte!", "**Domingo:** O t√∫mulo estava vazio."],
                quiz_questions: [
                    { q: "O que acharam no domingo?", a: "O t√∫mulo vazio", o: ["Jesus dormindo", "Soldados", "Nada"] },
                    { q: "Quem viu primeiro?", a: "Maria Madalena", o: ["Pedro", "Tom√©", "Judas"] },
                    { q: "Dia da ressurrei√ß√£o?", a: "Domingo", o: ["S√°bado", "Sexta", "Segunda"] },
                    { q: "Quem duvidou?", a: "Tom√©", o: ["Jo√£o", "Mateus", "Tiago"] }
                ]
            },
            6: {
                id: 6,
                title: "Segunda Vinda de Jesus",
                bible_ref: "Mateus 24,35-44",
                points: 200,
                content: ["**Ele Voltar√°:** Em gl√≥ria para julgar.", "**Vigil√¢ncia:** Estejam preparados."],
                quiz_questions: [
                    { q: "Quem sabe o dia da volta?", a: "S√≥ o Pai", o: ["O Papa", "Anjos", "Profetas"] },
                    { q: "Nossa atitude deve ser...", a: "Vigil√¢ncia", o: ["Medo", "Sono", "Curiosidade"] },
                    { q: "Como Ele vir√°?", a: "Em gl√≥ria", o: ["Como beb√™", "Escondido", "Em esp√≠rito"] },
                    { q: "O que passar√°?", a: "C√©u e terra", o: ["Palavra de Deus", "Amor", "Alma"] }
                ]
            },
            // Aulas 7 a 28 (Geradas Automaticamente)
            ...Array.from({length: 22}, (_, i) => i + 7).reduce((acc, id) => {
                acc[id] = {
                    id: id,
                    title: `Aula ${id}: Tema a definir`,
                    bible_ref: "B√≠blia",
                    points: 200,
                    content: ["Conte√∫do em breve..."],
                    quiz_questions: generatePlaceholderQuestions(id)
                };
                return acc;
            }, {})
        };
        
        courseData[13].title = "üèÜ PROVA INTERMEDI√ÅRIA";
        courseData[28].title = "üèÜ PROVA FINAL";

        // --- APP LOGIC ---
        window.App = {
            db: null, userId: null,
            userProgress: { score: 0, completedLessons: {}, name: null },
            state: { currentScreen: 'map', hearts: 5, quizData: [], quizIndex: 0, quizScore: 0 },

            init(db, userId) {
                this.db = db; this.userId = userId;
                window.startProgressListener(userId);
                this.render();
            },

            setUserProgress(p) {
                this.userProgress = { ...this.userProgress, ...p };
                const modal = document.getElementById('name-modal');
                if (!this.userProgress.name) {
                    modal.classList.remove('hidden'); modal.classList.add('flex');
                } else {
                    modal.classList.add('hidden');
                }
                this.render();
            },

            saveUserName() {
                const name = document.getElementById('user-name-input').value.trim();
                if (name.length > 2) {
                    this.userProgress.name = name;
                    window.saveProgress(this.userProgress);
                    document.getElementById('name-modal').classList.add('hidden');
                } else alert("Nome muito curto!");
            },

            navigateTo(screen, param) {
                this.state.currentScreen = screen;
                this.state.currentParam = param;
                this.render();
            },

            render() {
                const app = document.getElementById('app');
                document.getElementById('current-score').innerText = this.userProgress.score;
                document.getElementById('hearts-count').innerText = this.state.hearts;
                
                // Tabs
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                if(this.state.currentScreen === 'map') document.getElementById('nav-map').classList.add('active');
                if(this.state.currentScreen === 'ranking') document.getElementById('nav-ranking').classList.add('active');

                // Header Logic
                const headerT = document.getElementById('header-title');
                const hearts = document.getElementById('hearts-display');
                
                if(this.state.currentScreen === 'quiz') {
                    headerT.innerText = "Quiz"; hearts.classList.remove('hidden');
                } else {
                    headerT.innerText = "F√© Power-Up"; hearts.classList.add('hidden');
                }

                if (this.state.currentScreen === 'map') app.innerHTML = this.renderMap();
                else if (this.state.currentScreen === 'ranking') this.renderRanking();
                else if (this.state.currentScreen === 'lesson') this.renderLesson();
                else if (this.state.currentScreen === 'quiz') app.innerHTML = this.renderQuiz();
                else if (this.state.currentScreen === 'result') app.innerHTML = this.renderResult();
            },

            renderMap() {
                let h = '<div class="flex flex-col items-center p-4 space-y-6 pb-24 w-full">';
                Object.keys(courseData).map(Number).sort((a,b)=>a-b).forEach(id => {
                    const l = courseData[id];
                    const done = !!this.userProgress.completedLessons[id];
                    const open = id === 1 || !!this.userProgress.completedLessons[id-1];
                    const icon = done ? '‚úì' : (id===13||id===28?'üèÜ':'‚òÖ');
                    const color = open ? (done?'bg-yellow-400 border-yellow-600':'bg-green-500 border-green-700') : 'bg-gray-300 border-gray-400';
                    const margin = id%2===0 ? 'ml-12' : 'mr-12';
                    
                    h += `<div class="flex flex-col items-center ${margin} ${open?'':'opacity-70'}">
                        <button onclick="window.App.start(${id})" ${!open?'disabled':''} class="w-20 h-20 rounded-full border-b-4 flex items-center justify-center text-3xl text-white font-bold shadow-lg mb-2 transition active:scale-95 ${color}">${icon}</button>
                        <span class="text-xs font-bold text-gray-500 bg-white px-2 py-1 rounded border shadow-sm max-w-[120px] text-center leading-tight">${l.title}</span>
                    </div>`;
                });
                return h + '</div>';
            },

            async renderRanking() {
                const app = document.getElementById('app');
                app.innerHTML = '<div class="p-6 text-center"><h2 class="text-2xl font-bold mb-4">üèÜ Melhores Alunos</h2><div id="list" class="space-y-3 pb-24"><p>Carregando...</p></div></div>';
                const list = await window.getLeaderboard();
                const div = document.getElementById('list');
                div.innerHTML = '';
                if(list.length===0) div.innerHTML = '<p class="text-gray-500">Ranking vazio.</p>';
                list.forEach((u, i) => {
                    const isMe = u.name === this.userProgress.name;
                    div.innerHTML += `<div class="flex justify-between items-center p-4 rounded-xl border-b-4 ${isMe?'bg-blue-50 border-blue-200':'bg-white border-gray-100'}">
                        <span class="font-bold text-lg w-8">#${i+1}</span>
                        <span class="font-bold flex-grow text-left ${isMe?'text-blue-600':''}">${u.name}</span>
                        <span class="font-bold text-yellow-600">${u.score} XP</span>
                    </div>`;
                });
            },

            start(id) {
                if(courseData[id].content.length) this.navigateTo('lesson', id);
                else this.startQuiz(id);
            },

            renderLesson() {
                const l = courseData[this.state.currentParam];
                const app = document.getElementById('app');
                let h = `<div class="p-6 pb-32 animate-slide-up"><h2 class="text-2xl font-bold mb-2">${l.title}</h2><p class="text-sm font-bold text-gray-400 mb-6 uppercase">${l.bible_ref}</p><div class="space-y-4">`;
                l.content.forEach(t => h+=`<div class="bg-white p-4 rounded-xl border-2 border-gray-100 text-lg text-gray-700 shadow-sm">${t.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')}</div>`);
                h += `</div><div class="fixed bottom-20 left-0 right-0 p-4 bg-gradient-to-t from-white via-white to-transparent"><button onclick="window.App.startQuiz(${l.id})" class="w-full duo-start-btn py-4 rounded-xl text-white font-bold text-lg uppercase shadow">Come√ßar Quiz</button></div></div>`;
                app.innerHTML = h;
            },

            startQuiz(id) {
                this.state.hearts = 5; this.state.quizScore = 0; this.state.quizIndex = 0;
                this.state.quizData = [...courseData[id].quiz_questions].sort(()=>Math.random()-0.5).slice(0,10);
                this.navigateTo('quiz', id);
            },

            renderQuiz() {
                const q = this.state.quizData[this.state.quizIndex];
                const p = (this.state.quizIndex / this.state.quizData.length)*100;
                const opts = [q.a, ...q.o].sort(()=>Math.random()-0.5);
                return `<div class="p-4 pb-32 h-full flex flex-col"><div class="w-full bg-gray-200 rounded-full h-3 mb-6"><div class="bg-green-500 h-3 rounded-full transition-all" style="width:${p}%"></div></div>
                <h2 class="text-2xl font-bold text-gray-700 mb-6 flex-grow">${q.q}</h2>
                <div class="space-y-3">${opts.map(o => `<button onclick="window.App.check(this, '${o.replace(/'/g,"\\'")}', '${q.a.replace(/'/g,"\\'")}')" class="duo-option-btn w-full p-4 rounded-xl text-left text-lg font-medium text-gray-700">${o}</button>`).join('')}</div></div>`;
            },

            check(btn, sel, cor) {
                document.querySelectorAll('.duo-option-btn').forEach(b => b.disabled = true);
                if(sel===cor) { btn.classList.add('duo-correct'); this.state.quizScore++; }
                else { btn.classList.add('duo-wrong'); this.state.hearts--; document.querySelectorAll('.duo-option-btn').forEach(b=>{if(b.innerText===cor)b.classList.add('duo-correct')}); }
                
                const div = document.createElement('div');
                div.className = `fixed bottom-0 left-0 right-0 p-4 border-t-2 z-50 animate-slide-up ${sel===cor?'bg-green-100 border-green-300':'bg-red-100 border-red-300'}`;
                div.innerHTML = `<div class="max-w-2xl mx-auto flex justify-between items-center"><span class="font-bold text-xl ${sel===cor?'text-green-700':'text-red-700'}">${sel===cor?'Correto!':'Errado...'}</span><button onclick="window.App.next()" class="px-6 py-3 rounded-xl font-bold text-white uppercase ${sel===cor?'bg-green-500 border-b-4 border-green-700':'bg-red-500 border-b-4 border-red-700'}">Continuar</button></div>`;
                document.body.appendChild(div);
            },

            next() {
                document.querySelector('.fixed.bottom-0.z-50').remove();
                if(this.state.hearts<=0) return this.finish(false);
                this.state.quizIndex++;
                if(this.state.quizIndex>=this.state.quizData.length) this.finish(true);
                else document.getElementById('app').innerHTML = this.renderQuiz();
            },

            finish(pass) {
                const id = this.state.currentParam;
                const win = pass && this.state.quizScore >= Math.ceil(this.state.quizData.length*0.6);
                if(win) {
                    if(!this.userProgress.completedLessons[id]) {
                        this.userProgress.score += courseData[id].points;
                        this.userProgress.completedLessons[id] = true;
                    }
                    window.saveProgress(this.userProgress);
                }
                this.navigateTo('result', { win, s: this.state.quizScore, t: this.state.quizData.length });
            },

            renderResult() {
                const { win, s, t } = this.state.currentParam;
                return `<div class="flex flex-col items-center justify-center h-full p-6 text-center animate-slide-up pb-32">
                    <div class="text-8xl mb-4">${win?'üéâ':'üíî'}</div><h2 class="text-3xl font-bold mb-2 ${win?'text-green-600':'text-red-500'}">${win?'Li√ß√£o Conclu√≠da!':'N√£o desista!'}</h2>
                    <p class="text-gray-500 text-lg mb-8">Acertou ${s} de ${t}</p>
                    <button onclick="window.App.navigateTo('map')" class="w-full duo-start-btn py-4 rounded-xl text-white font-bold text-lg uppercase">Continuar</button></div>`;
            },
            
            loadLeaderboard() { this.navigateTo('ranking'); }
        };
    </script>
</body>
</html>
